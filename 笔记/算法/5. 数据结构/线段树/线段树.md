# 线段树

---

### 一、原理

1. push up操作：由子节点去计算父节点的信息
2. push down操作（也称为**懒标记**、延迟标记）：把当前父节点的修改信息下传给子节点
3. 扫描线

线段树结构：
![](assets/Pasted%20image%2020250509195117.png)

线段树除了最后一层外，是个满二叉树，可以用一维数组存整棵树
🌟🌟🌟若编号为 x 的节点，其父节点为 $x >> 1$ （下取整），左儿子为 $2x\;(或：x<<1)$ ，右儿子为 $2x+1\;(x<<1|1)$ （x 左移 1 或 1）

开数组时需要开 4n - 1 的空间

只有涉及区间修改的，才会用到懒标记，即：pushdown

### 二、代码功能实现
#### 基本操作

1. pushup（u）
2. build（）：将一段区间初始化为线段树
3. modify（）：
	1. 修改单点
	2. 修改区间（pushdown） ----- 用到懒标记
4. query（）：查询某段区间的信息

#### build 操作

```C++
void build(int u, int l, int r)
{
	tr[u] = {l, r};// 当前节点的左右儿子
	if (l == r) return ;// 如果已经是叶子结点了，就不再递归
	int mid = tr[u].l + tr[u].r >> 1;
	build(u << 1, l, mid), build(u << 1 | 1, mid + 1, r);// 递归建立左右区间
	
}
```