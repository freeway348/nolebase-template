# 处理机调度

---

### 一、处理机调度的基本概念

```
在选择调度算法时，需要考虑算法的特性
```
#### （一）算法选择的重要指标
##### 1. CPU利用率

- CPU是计算机中最重要的资源之一，所以应尽可能使CPU保持**忙碌**的状态，使这一资源的利用率最高
- CPU利用率是指CPU处于**忙碌**状态占所有状态的比例
##### 2. 系统吞吐量

- 表示单位时间内CPU完成作业的数量
##### 3. 周转时间

- 周转时间：**从作业提交到作业完成**所经历的时间
	- $\text{作业的周转时间} = \text{作业完成时间} - \text{作业提交时间}$ 
- 平均周转时间：多个作业周转时间的平均值
- 带权周转时间：作业周转时间与作业实际运行时间的比值
	- $带权周转时间=\frac{作业周转时间}{作业实际运行时间}$
- 平均带权周转时间：多个作业带权周转时间的平均值
##### 4. 等待时间

- 等待时间：进程处于等待处理机状态的时间之和
##### 5. 响应时间

- 响应时间：用户从提交请求到系统**首次**产生相应所用的时间
- 在**交互式系统**中，一般采用响应时间作为衡量调度算法的重要准则之一
#### （二）调度的层次

```
作业，即用户在计算机系统中完成一个任务的过程。
作业由程序、数据及作业说明书组成，一个作业从进入系统到退出系统一般要经过提交、后备、执行、完成这4个状态。
1.提交状态：作业通过用户由输入设备进入输入系统。
2.后备状态：作业提交后，由系统为该作业建立作业控制块(JCB，JobContrd Block)，并把它插入后备作业队列中，等待作业调度程序的调度。
3.执行状态：后备状态的作业若被作业调度选中，并且分配了必要的资源，由作业调度程序建立相应的进程。
4.完成状态：当作业执行结束后，进入作业完成状态。此时，由作业调度程序对该作业进行善后处理，主要表现为撤消作业的作业控制块，并回收此作业占用的系统中的资源数。最后，将作业的结果输出到外设之中。
```
##### 1. 作业调度（高级调度）

- 按照一定的原则从外存中处于后备状态的作业中挑选一个或者多个作业，为它们分配内存、I/O资源等必要资源，并建立相应的进程，以使它们获得竞争处理机的权利
	- 作业由外存**调入**内存中
	- 后备队列（外存） $\rightarrow$   分配资源，建立进程，从创建态变为就绪态，进入就绪队列（内存）
##### 2. 内存调度（中级调度）

- 作用：提高内存利用率和系统吞吐量
- 将**挂起的作业**从外存**调回**内存中
- 引入虚拟内存后，OS可以将暂时不用的进程放到外存中（该进程进入**挂起状态**），等到空闲时再将其重新调入内存，通过不断地调入调出，内存调度的频率比作业调度的频率高
- 暂时调到外存等待的进程状态为挂起状态。值得注意的是，**PCB并不会一起调到外存**，而是会常驻内存。PCB中会记录进程数据在外存中的存放位置，进程状态等信息，操作系统通过内存中的PCB来保持对各个进程的监控、管理。被挂起的进程PCB会被放到的挂起队列中。（注：这个PCB是仍然放在内存中的）

##### 3. 进程调度（低级调度）

- 按照某种方法和策略从**就绪队列**（内存）中选取一个进程，将处理机（CPU）分配给它，使该进程由就绪态变为运行态
- 进程调度的频率是三种调度方法中最高的

#####  进程的七状态模型

![](assets/Pasted%20image%2020241216201359.png)

#### （三）进程调度方式
##### 1. 非剥夺调度方式（非抢占方式）

- 只允许进程**主动放弃CPU**，在运行过程中，即便有更为紧迫的进程到达，该进程仍会继续使用CPU，直到**该进程终止**或**主动要求进入阻塞态**时，才会将CPU让给其他进程
- 系统开销更小，但无法及时处理更加紧急的任务
##### 2. 剥夺调度方式（抢占方式）

- 当某一优先级更高的进程进入就绪队列并需要使用CPU，那么正在使用CPU的进程将会**被动**地放弃CPU，将CPU让给更为紧迫的进程使用
- 能够提高系统吞吐量和响应效率
#### （四）进程调度的时机

1. 当前进程主动放弃处理机
	1. 进程正常终止（执行完毕）
	2. 进程运行过程中发生异常而终止
	3. 进程主动请求阻塞（如：请求系统分配资源等）
2. 当前进程被动放弃处理机
	1. 分配给当前进程的时间片用完
	2. 有更紧急的事件需要处理，如：I/O事件，I/O中断等等
	3. 有更高优先级的进程进入就绪队列（抢占式）

>[!tip] 注意！！！
>进程在操作系统**内核程序临界区**中不能进行调度和切换  -------（对）
>进程处于**临界区**时不能进行处理机调度 -------（错）
- 因为内核程序临界区一般会将访问内的临界资源**上锁**，导致其他内核程序无法调度，而就绪队列也被锁了，所以无法访问就绪队列，也就无法进行进程调度[^1]







[^1]: 临界区和内核程序临界区的区别