# 引论

---

### 一、操作系统的基本概念[^3]

- 控制和管理整个计算机的硬件和软件资源，合理地组织调度计算机的工作和资源的分配，提供给用户和其他软件比较方便的接口和环境
- 是计算机系统中**最基本的系统软件**
	- 注意！！！ OS**不是硬件**！！！
- 从下至上的计算机系统结构：裸机 $\Rightarrow$ OS（操作系统） $\Rightarrow$ 应用程序 $\Rightarrow$ 用户
	- ![](assets/Pasted%20image%2020241124192838.png)
	- 计算机系统：如win11，linux等
	- 裸机：硬件，如CPU，输入输出设备等
#### 操作系统（OS）的功能

- 对上层结构：为应用程序和用户提供方便的接口和环境
- 对下层结构：分配硬件资源和软件资源，控制和管理计算机的硬件和软件
- 是最靠近裸机的一层，即是**最基本的系统软件**

### 二、操作系统的基本特征[^4]

```
操作系统的基本特征包括：并发、共享、虚拟、同步
```

#### 1. 并发

```
操作系统就是伴随着“多道程序技术”而出现的。因此，操作系统和程序并发是一起诞生的
```
##### 定义

- 指两个或多个事件在**同一时间间隔**发生。宏观上看是同时发生的，微观上是交替进行的

##### 区分：并行

- 并行指的是具有同时进行运算和操作的特性，在**同一时刻**能完成两种或以上的工作

##### 重要考点[^6]

- **单核CPU**同一时刻只能执行**一个程序**，各个程序只能**并发**地执行
- **多核CPU**同一时刻可以同时执行**多个程序**，多个程序可以**并行**地执行
	- 例如：`4`核CPU可以同时（同一时刻）**并行**运行四个程序，但当需要运行四个以上，如：五个、六个程序时，仍然需要**并发**执行，所以操作系统的并发性依然是不可缺少的

#### 2. 共享
##### 定义

- 系统中的资源可供内存中多个**并发执行**的进程共同使用
##### 分类

1. 互斥共享方式：资源在特定时间间隔内**只允许一个进程**访问该资源
2. 同时共享方式：一个时间段内**允许多个进程**同时对某些资源进行访问
	- 宏观上看是同时发生的，而在微观上可能是交替进行的

>[!tips] 重点[^7]
>并发和共享是操作系统中两个**最基本的特征**，两者之间是互为存在的关系：
>>1. 如果失去并发性，即：系统中只有一个进程在运行，则共享性就失去了意义
>>2. 如果失去共享性，则并发进行的进程无法共享资源
>
>没有并发和共享，就谈不上虚拟和异步

#### 3. 虚拟
##### 定义

- 一个物理意义上的实体变为若干个虚拟逻辑上的对应物
	- 物理实体是实际存在的，逻辑上的对应物是用户感受到的
	- 用于实现虚拟这一特性的技术，称为虚拟技术
		- 虚拟存储器技术是通过多道程序设计技术，采用让多道程序并发执行的方法，来分时使用一个处理器，但在用户看来（逻辑上）就是同时进行的
- 技术分类：
	1. 空分复用技术（如：虚拟存储器技术）
	2. 时分复用技术（如：虚拟处理器）
		- 如果失去了并发性，那么就不存在虚拟性了

#### 4. 异步
##### 定义

- 在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的，而是走走停停（做一部分停一会），以不可预知的速度前进，这就是进程的异步性
	- 如果失去了并发性，即：系统只能串行地运行各个程序，那么每个程序的执行会一贯到底。只有系统拥有并发性，才有可能导致异步性

### 三、操作系统的功能和接口
#### 1. 作为计算机系统资源的管理者

- 对资源进行管理：**处理机管理、存储器管理**、文件管理、设备管理[^1]

##### （1）处理机管理

- 在**多道程序**环境下，处理机的分配和运行都**以进程为基本单位**，所以也可将处理机管理归纳为为对进程的管理
- 进程管理的主要功能：进程控制、进程同步、进程通信、死锁处理、处理机调度等

##### （2）存储器管理

- 为了给多道程序的运行提供良好环境，方便用户使用并**提高内存利用率**
- 主要功能包括：内存分配和回收、地址映射、内存保护和共享、内存扩充等

##### （3）文件管理

- 负责文件管理的部分称为**文件系统**
- 文件管理包括：文件存储空间的管理、目录管理及文件读写管理和保护等

##### （4）设备管理

- 主要任务：完成用户的 I/O 请求，方便用户使用设备，并**提高设备利用率**
- 主要包括：缓冲管理、设备分配、设备处理和虚拟设备等

#### 2. 作为计算机硬件系统和用户之间的接口

- 接口主要分为两类：
	1. 命令接口：直接进行访问
	2. 程序接口：间接进行访问

##### （1）命令接口

- 按作业控制方式不同分为：联机命令接口和脱机命令接口
	- 联机命令接口：又称为**交互式**命令接口，适用于分时或实时系统的
		- 如：windows的cmd终端（“小黑框”）就是交互式命令接口
		- 用户说一句，系统就做一句
	- 脱机命令接口：又称为**批处理**命令解耦，适用于批处理系统，它由一组作业控制命令组成
		- 批处理：将任务写在清单列表上，按照清单一个一个完成
		- 用户说一系列任务，系统再处理一系列任务
##### （2）程序接口

- 程序接口由一组**系统调用**组成
- 用户通过在程序中使用这些系统调用来请求操作系统为其提供服务
- 当前最流行的就是图形应用界面（GUI），即：图形接口
	- 图形接口不是OS的一部分，但其调用的命令是OS的一部分
##### （3）操作系统OS用作扩充机器/虚拟机

- 裸机：没有任何软件支持的计算机
- 扩充机器/虚拟机：覆盖了软件的机器
	- 只有安装了OS的裸机，才能在其上面安装应用程序等
### 四、操作系统的运行环境[^5]
#### 别名

- 内核态 = 核心态 = 管态
- 用户态 = 目态
#### 1. 用户态和核心态/内核态

```
普通程序员写的程序就是应用程序，而实现操作系统的程序则是内核程序，由很多内核程序组成了操作系统内核，或简称为"内核"
```
- 用户态：应用程序运行时，OS处于用户态，CPU只能执行非特权指令
- 核心态/内核态：操作系统内核程序运行在核心态/内核态，CPU可以执行特权指令
#### 2. 内核

- 地位：内核是操作系统中**最重要最核心**的部分，也是**最接近硬件的部分**
- 操作系统的功能未必都在内核中，如：图形化界面GUI；就算没有GUI，也可以使用cmd终端(“小黑框”)来使用操作系统
- 内核：计算机最底层的软件，包含以下四个方面的内容：
	1. 时钟管理：用于计时、时钟中断
		- OS通过时钟管理向用户提供准确的时间，通过时钟中断的管理来实现进程的切换
	2. 中断机制：可提高多道程序环境中CPU的利用率
	3. 原语：是底层的可被调用的小程序
		- 位于操作系统的最底层
		- 具有原子性，其操作不可中断，运行即完成为止
		- 运行时间短，调佣较频繁
		- 定义原语的直接操作就是关中断，在关中断的状态下执行完整个原语操作
	4. 系统控制的数据结构及处理
#### 3. 操作系统的运行机制
##### 本质[^8]

- 发生中断就意味着操作系统的介入，并开展管理工作
- 用户态 $\rightarrow$ 核心态/内核态：通过**中断**实现（触发中断信号意味着操作系统强制夺回CPU的控制权），并且**中断**是**唯一途径**[^2]，硬件会自动完成转换过程
	- 在CPU变为内核态后，将会停止运行目前正在运行的应用程序，转而运行一个处理中断信号的内核程序，当内核程序运行完成后，才将CPU使用权再还给应用程序（但不一定是给被中断的那个，可能是不同的应用程序）
- 核心态/内核态 $\rightarrow$ 用户态：通过执行一个**特权指令**，将`程序状态字（PSW）`的标志位设置为用户态
	- `PSW`为`1`时，表示CPU处于"内核态"，`0`表示"用户态"
#### 4. 中断（外中断）和异常（内中断）

##### 内中断/异常/例外/陷入

- 信号来源：CPU内部，与当前指令有关
	- 如果当前指令或指令参数是非法的，则会引发一个中断信号
- 例如：
	1. 资源中断 --- 指令中断（**陷入指令**）
		- 系统调用时使用的**访管指令（又叫陷入指令，trap指令）**，用于请求操作系统内核的服务，该指令就会引发一个内部中断信号
			- 陷入指令是一条比较特殊的指令，但并不是特权指令，它意味着应用程序**主动地**将CPU控制权还给操作系统内核，如“系统调用”就是通过陷入指令完成的
	2. 强迫中断 --- 故障
		- 硬件**故障**（如：缺页故障）或软件中断（如：整数除`0`）
		- 由错误条件引起，可能被内核程序修复。修复故障后，CPU使用权将会还给应用程序，让它继续执行下去
	3. 终止
		- 由致命错误引起，内核程序无法修复该错误，因此一般不再将CPU使用权还给引起终止的应用程序，而是直接终止该应用程序。如：整数除`0`，非法使用特权指令等
##### 外中断/中断

- 作用：“中断”是让操作系统内核（管理者）夺回CPU使用权的**唯一途径**
- 信号来源：CPU外部，与当前指令无关
- 例如：时钟中断
	1. 外设请求
		- I/O操作完成发出的中断信号
	2. 人工干预
		- 用户强制终止一个进程
#### 5. 中断机制的基本原理

##### 检查中断信号
###### 内中断

- CPU在执行指令时会检查是否有异常发生
###### 外中断

- 每个指令周期末尾，CPU都会检查是否有外中断信号需要处理
##### 找到相应的中断处理程序
```
不同的中断程序，需要用不同的中断处理程序来处理
```
- 当CPU检测到中断信号后，会根据中断信号的类型去查询“**中断向量表**”，以此来找到相应的中断处理程序在内存中的位置
	- 例图：![](assets/Pasted%20image%2020241201214035.png)
	- 显然，**中断处理程序一定是内核程序**，需要运行在**内核态**


### 五、系统调用










>这一节内容的必考点主要出现于选择、填空部分

[^1]: 处理机管理和存储器管理是一部分重点
[^2]: 中断，重点
[^3]: 必考点1：OS基本概念
[^4]: 必考点2：OS特征
[^5]: 必考点3：OS运行环境
[^6]: 重要考点：多核CPU和单核CPU
[^7]: 重点
[^8]: CPU的状态切换，用户态和核心态